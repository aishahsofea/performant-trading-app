# Story 1.3: Basic UI Framework and Deliberately Heavy Styling

## Status

Draft

## Story

**As a** performance optimization learner,
**I want** a trading dashboard with deliberately unoptimized assets and animations using my existing Storybook design system,
**so that** I have clear performance bottlenecks to optimize while maintaining my current design approach.

## Acceptance Criteria

1. Extend existing Storybook design system with heavy component variants
2. Heavy animation libraries loaded upfront (Framer Motion + Lottie + custom animations)
3. Unoptimized images and icons loaded synchronously without lazy loading
4. Large web fonts loaded blocking render with no font-display optimization
5. JavaScript bundles with no tree shaking and unused dependencies
6. Large JSON data files loaded synchronously for trading dashboard
7. Synchronous API calls blocking render during data loading
8. Global styles causing excessive repaints and layout shifts

## Tasks / Subtasks

- [x] Storybook Design System Extension (AC: 1)
  - [x] Create heavy component variants in existing Storybook
  - [x] Add complex trading chart components with excessive DOM elements
  - [x] Implement data-heavy table components without virtualization
  - [x] Create animated component variants for performance comparison
- [x] Animation Library Loading (AC: 2)
  - [x] Install and configure Framer Motion with full bundle
  - [x] Add Lottie animations with large JSON files for trading indicators
  - [x] Create custom animation library with redundant keyframes
  - [x] Load all animation libraries upfront without code splitting
- [ ] Unoptimized Asset Loading (AC: 3)
  - [ ] Add large trading chart images without optimization or lazy loading
  - [ ] Load all icons synchronously at application start
  - [ ] Implement multiple image formats without responsive images
  - [ ] Create asset loading without compression for trading logos/graphics
- [ ] Font Loading Bottlenecks (AC: 4)
  - [ ] Load multiple web font families with all weights
  - [ ] Configure fonts to block render (no font-display: swap)
  - [ ] Add custom fonts without preloading
  - [ ] Implement font loading without subsetting
- [ ] JavaScript Bundle Bloat (AC: 5)
  - [ ] Install heavy dependencies without tree shaking
  - [ ] Import entire libraries instead of selective imports
  - [ ] Add unused trading calculation libraries
  - [ ] Configure bundling to prevent optimization
- [ ] Synchronous Data Loading (AC: 6, 7)
  - [ ] Create large JSON files with mock trading data
  - [ ] Implement synchronous data fetching blocking render
  - [ ] Load all trading data upfront without pagination
  - [ ] Create blocking API calls during component initialization
- [ ] Layout Shift Creation (AC: 8)
  - [ ] Create global styles causing repaints in trading dashboard
  - [ ] Implement dynamic content loading without size reserving
  - [ ] Add styles that trigger layout recalculations
  - [ ] Configure CSS that causes cumulative layout shift in charts

## Dev Notes

### Previous Story Context

Story 1.2 (Authentication and User Management Infrastructure) completed successfully with comprehensive user authentication system:

- NextAuth.js configuration with JWT strategy and Google OAuth
- User profile management with trading preferences
- Drizzle ORM + Supabase PostgreSQL integration
- Protected route middleware and session management
- User-specific dashboard layout persistence

### Architecture Context

**Repository Structure**: Building on authenticated dashboard foundation

```
trading-platform/
├── apps/
│   ├── dashboard/                    # Main Next.js app (existing)
│   │   ├── src/app/                 # Authenticated routes ready
│   │   ├── src/components/ui/       # New: Heavy UI components
│   │   ├── src/styles/              # New: Multiple CSS frameworks
│   │   └── public/assets/           # New: Unoptimized images/fonts
│   └── api/                         # Future API services
├── packages/
│   ├── ui/                          # Shared component library (heavy)
│   ├── auth-lib/                    # Authentication utilities (existing)
│   └── shared/                      # Common utilities and types
```

**Platform Integration**: Extends Vercel + Supabase + authentication setup

- **Vercel**: Serves heavy assets and CSS bundles
- **Supabase**: User-specific UI preferences storage
- **Performance Monitoring**: Tracks CSS/JS bundle sizes from Story 1.1
- **User Context**: Personalized heavy UI themes per user

### Technology Stack Details

**Design System Integration**:
- Existing Storybook design system (preserved)
- Heavy component variants for performance testing
- Trading-specific components with excessive DOM elements
- Performance comparison variants in Storybook

**Animation Libraries**:
- Framer Motion for component animations
- Lottie for complex trading indicator animations
- Custom CSS animations and keyframes
- Three.js for 3D trading charts (future consideration)

**Asset Management**:
- Large uncompressed trading chart images
- Comprehensive icon libraries loaded upfront
- Multiple web font families with all weights
- No lazy loading or optimization for trading assets

**Data Loading**:
- Large JSON files with mock trading data
- Synchronous API calls blocking render
- Heavy JavaScript libraries without tree shaking
- Unoptimized data fetching patterns

### Security Requirements

**Style Security**:
- CSS injection prevention in styled-components
- Inline style sanitization
- Content Security Policy for external fonts
- User-generated content style restrictions

**Asset Security**:
- Image upload validation and scanning
- Font file integrity verification
- Animation file security checks
- External resource Content Security Policy

### Integration Points

**Existing System Integration**:
- Extends PerformanceProvider to monitor CSS/JS bundle metrics
- Integrates with user authentication for personalized themes
- Connects to dashboard layout persistence from Story 1.2
- Maintains compatibility with existing performance monitoring

**New System Dependencies**:
- Storybook component variant coordination
- Animation library integration with existing design system
- Asset loading pipeline without optimization
- Trading data synchronous loading patterns

### File Locations

Based on existing repository structure:

- **UI Components**: `apps/dashboard/src/components/ui/`
- **Style Files**: `apps/dashboard/src/styles/`
- **Assets**: `apps/dashboard/public/assets/`
- **Configuration**: `tailwind.config.js`, `next.config.js`
- **Types**: `apps/dashboard/src/types/ui.ts`
- **Component Library**: `packages/ui/`

### Technical Constraints

**Design System Compatibility**: Preserve existing Storybook design system
**Performance Impact**: Deliberate degradation for learning purposes
**Bundle Size**: Intentionally large JavaScript bundles for optimization learning
**TypeScript**: Maintain strict typing with all UI components
**User Experience**: Functional but intentionally slow due to synchronous loading

### Testing Requirements

**UI Testing**:
- Visual regression testing with Storybook component variants
- Component functionality with heavy data loads
- Animation performance testing with trading indicators
- Cross-browser compatibility with synchronous loading

**Performance Testing**:
- Bundle size monitoring and alerts
- Core Web Vitals degradation tracking
- Layout shift measurement
- Font loading impact analysis

## Change Log

| Date  | Version | Description                                              | Author             |
| ----- | ------- | -------------------------------------------------------- | ------------------ |
| Today | 1.0     | Initial story creation for heavy UI framework and styling | Bob (Scrum Master) |

## Dev Agent Record

_This section will be populated by the development agent during implementation_

### Agent Model Used

Sonnet 4 (claude-sonnet-4-20250514)

### Debug Log References

- AC1 Storybook Extension: Created 3 heavy components with performance bottlenecks
- HeavyButton: 50+ nested DOM elements with excessive animations and gradients
- HeavyTradingChart: 2000+ SVG elements with complex rendering and floating particles
- HeavyDataTable: 3000+ table rows without virtualization and excessive decorations
- Performance Control Panel: Safe mode toggles to prevent Storybook crashes
- AC2 Animation Library Loading: Implemented heavy animation system with deliberate performance bottlenecks
- Framer Motion: Full bundle loaded upfront with complete API (no tree shaking)
- Lottie Animations: 3 large JSON files (bull, bear, stock chart indicators) with complex keyframes
- Custom Animation Library: 5 variants with 60+ keyframes each and redundant properties
- Upfront Loading: All libraries loaded synchronously with 1000-iteration processing loop

### Completion Notes List

- **Heavy Component Variants**: Created HeavyButton with excessive DOM elements (50+ nested divs), multiple CSS animations (pulse, bounce, ping), and complex gradient overlays
- **Trading Chart Complexity**: Implemented HeavyTradingChart with 2000+ data points, individual SVG elements per point, 200+ background decorations, and floating particle animations
- **Data Table Performance Impact**: Built HeavyDataTable with 3000 rows, no virtualization, excessive cell decorations, and complex hover animations
- **Performance Controls**: Added Safe Mode defaults and Performance Control Panel to prevent Storybook crashes while enabling testing
- **Storybook Integration**: All components exported through UI package with comprehensive stories and performance comparison variants
- **Animation Library Loading**: Implemented HeavyAnimationLoader with deliberate synchronous loading of all animation libraries upfront
- **Framer Motion Integration**: Full bundle installation with complete API loaded (useAnimation, useMotionValue, useTransform, etc.) preventing tree shaking
- **Large Lottie Files**: Created 3 complex JSON animations (trading-indicator-bull.json, trading-indicator-bear.json, complex-stock-chart.json) with extensive keyframes and properties
- **Custom Animation System**: Built heavy-animations.ts with 5 animation variants containing 60+ keyframes each with redundant properties (heavyBounce, heavyPulse, heavySpin, heavyFloat, heavyShake)
- **Performance Bottleneck**: Implemented 1000-iteration synchronous processing loop during animation loading to create measurable performance impact

### File List

- `packages/ui/src/components/heavy-button.tsx` - Performance-heavy button with excessive DOM elements and animations
- `packages/ui/src/components/heavy-trading-chart.tsx` - Complex SVG trading chart with 2000+ elements
- `packages/ui/src/components/heavy-data-table.tsx` - Non-virtualized table with 3000+ rows
- `packages/ui/src/index.tsx` - Updated exports for heavy components
- `apps/storybook/src/stories/HeavyButton.stories.tsx` - Button stories with performance controls
- `apps/storybook/src/stories/HeavyTradingChart.stories.tsx` - Chart stories with complexity toggles
- `apps/storybook/src/stories/HeavyDataTable.stories.tsx` - Table stories with virtualization comparison
- `apps/storybook/src/stories/PerformanceControlPanel.stories.tsx` - Master control panel for safe testing
- `apps/dashboard/src/animations/heavy-animations.ts` - Custom animation library with 5 variants and 60+ keyframes each
- `apps/dashboard/src/components/heavy-animation-loader.tsx` - Component for loading all animation libraries upfront
- `apps/dashboard/public/animations/trading-indicator-bull.json` - Large Lottie animation for bull market indicators
- `apps/dashboard/public/animations/trading-indicator-bear.json` - Large Lottie animation for bear market indicators
- `apps/dashboard/public/animations/complex-stock-chart.json` - Complex Lottie animation for stock chart visualization
- `apps/dashboard/src/app/heavy-animations-demo/page.tsx` - Demo page showcasing all heavy animations

## QA Results

_Results from QA Agent review will be added here after implementation_